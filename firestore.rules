rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // A regra agora corresponde a uma subcoleção 'studies' dentro de um documento de 'users'
    // O {userId} captura o ID do usuário do caminho do documento
    match /users/{userId}/studies/{studyId} {
      // Permite leitura e escrita (create, update, delete)
      // apenas se o ID do usuário autenticado (request.auth.uid)
      // for o mesmo que o ID no caminho do documento ({userId}).
      // Isso garante que um usuário só possa acessar sua própria subcoleção de estudos.
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
